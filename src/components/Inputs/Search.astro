---
import type { HTMLAttributes } from "astro/types"
import Icon from "astro-icon"

export type Props = HTMLAttributes<"input">
const { class: className, ...rest } = Astro.props
---

<label for="search" class="search-wrapper">
    <div class="inline-block w-full relative">
        <input
            class:list={["search", className]}
            type="search"
            name="search"
            id="search"
            {...rest}
            placeholder="Search..."
        />
        <button id="clear-button" class="clear-icon" id="clear-icon">
            <Icon name="ph:x" class="h-6" />
        </button>
    </div>
    <button>
        <Icon name="ph:magnifying-glass-duotone" class="search-icon" />
    </button>
</label>

<script>
    let clearButton = document.getElementById("clear-button")
    let search = document.getElementById("search") as HTMLInputElement
    if (clearButton && search) {
        clearButton.addEventListener("click", () => {
            search.value = ""
        })
    }
</script>

<style>
    /* Wrapper */
    .search-wrapper {
        @apply flex items-center w-full max-w-[36px] p-1;
        @apply border border-offwhite rounded-full opacity-75;
        transition: max-width 1s ease, padding 0.7s ease, opacity 0.7s ease;
    }
    .search-wrapper:has(.search:not(:placeholder-shown)),
    .search-wrapper:hover,
    .search-wrapper:focus-within {
        @apply pl-4 opacity-100;
        max-width: 100%;
    }

    /* Search Icon */
    .search-icon {
        @apply w-6 flex-shrink-0 opacity-100 hover:text-blue-accent;
    }
    .search-wrapper:hover .search-icon,
    .search-wrapper:focus-within .search-icon {
        @apply opacity-100;
    }

    /* Clear Icon */
    .clear-icon {
        @apply absolute right-0 opacity-0 hover:text-blue-accent;
        transition: opacity 0.3s ease;
    }
    .search:not(:placeholder-shown) + .clear-icon {
        @apply opacity-100;
    }

    /* Input */
    .search {
        @apply float-right bg-transparent max-w-full w-full;
        transition: padding 0.7s ease;
    }
    .search::-webkit-search-cancel-button {
        display: none;
    }
    .search:focus {
        outline: none;
    }
    .search::placeholder {
        @apply text-transparent opacity-75;
        transition: color 1s;
    }
    .search:not(:placeholder-shown),
    .search-wrapper:hover .search,
    .search-wrapper:focus-within .search {
        @apply pr-6;
    }
    .search-wrapper:hover .search::placeholder,
    .search-wrapper:focus-within .search::placeholder {
        @apply text-offwhite;
    }
</style>
